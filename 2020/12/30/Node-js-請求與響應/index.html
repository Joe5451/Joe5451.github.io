<!DOCTYPE html><html lang="zh-TW" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>[Node.js] 請求與響應 | Joe's Blog</title><meta name="keywords" content="Node.js"><meta name="author" content="JoeB"><meta name="copyright" content="JoeB"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="[Node.js] 請求與響應首先介紹在上一 Node.js 系列文章中出現的 req 及 res 物件。 Request Object將上一筆記中的 server.js 第四行 console.log(&#39;request made&#39;); 改為 console.log(req); 123456789const http &#x3D; require(&amp;#x27;http&amp;#x27;);cons">
<meta property="og:type" content="article">
<meta property="og:title" content="[Node.js] 請求與響應">
<meta property="og:url" content="http://example.com/2020/12/30/Node-js-%E8%AB%8B%E6%B1%82%E8%88%87%E9%9F%BF%E6%87%89/index.html">
<meta property="og:site_name" content="Joe&#39;s Blog">
<meta property="og:description" content="[Node.js] 請求與響應首先介紹在上一 Node.js 系列文章中出現的 req 及 res 物件。 Request Object將上一筆記中的 server.js 第四行 console.log(&#39;request made&#39;); 改為 console.log(req); 123456789const http &#x3D; require(&amp;#x27;http&amp;#x27;);cons">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://i.imgur.com/4OIbWlf.png">
<meta property="article:published_time" content="2020-12-30T12:42:05.000Z">
<meta property="article:modified_time" content="2020-12-30T12:51:11.195Z">
<meta property="article:author" content="JoeB">
<meta property="article:tag" content="Node.js">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.imgur.com/4OIbWlf.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2020/12/30/Node-js-%E8%AB%8B%E6%B1%82%E8%88%87%E9%9F%BF%E6%87%89/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '複製成功',
    error: '複製錯誤',
    noSupport: '瀏覽器不支援'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '剛剛',
    min: '分鐘前',
    hour: '小時前',
    day: '天前',
    month: '個月前'
  },
  copyright: undefined,
  ClickShowText: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2020-12-30 20:51:11'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><meta name="generator" content="Hexo 5.2.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">17</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">標籤</div><div class="length-num">6</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分類</div><div class="length-num">1</div></a></div></div></div><hr/></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://i.imgur.com/4OIbWlf.png)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Joe's Blog</a></span><span id="menus"><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><h1 class="post-title">[Node.js] 請求與響應</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">發表於</span><time class="post-meta-date-created" datetime="2020-12-30T12:42:05.000Z" title="發表於 2020-12-30 20:42:05">2020-12-30</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新於</span><time class="post-meta-date-updated" datetime="2020-12-30T12:51:11.195Z" title="更新於 2020-12-30 20:51:11">2020-12-30</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%B6%B2%E9%A0%81-%E7%B6%B2%E8%B7%AF%E7%9B%B8%E9%97%9C/">網頁/網路相關</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">閱讀量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Node-js-請求與響應"><a href="#Node-js-請求與響應" class="headerlink" title="[Node.js] 請求與響應"></a>[Node.js] 請求與響應</h1><p>首先介紹在上一 Node.js 系列文章中出現的 <code>req</code> 及 <code>res</code> 物件。</p>
<h2 id="Request-Object"><a href="#Request-Object" class="headerlink" title="Request Object"></a>Request Object</h2><p>將上一筆記中的 server.js 第四行 <code>console.log(&#39;request made&#39;);</code> 改為 <code>console.log(req);</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params"> req, res</span>) =&gt;</span> &#123; <span class="comment">// 兩個參數 req 為請求物件，res 為響應回覆物件</span></span><br><span class="line">    <span class="built_in">console</span>.log(req); <span class="comment">// 修改該行，列印出 req 物件</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>, <span class="string">&#x27;localhost&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;listening for requests on port 3000&#x27;</span>)</span><br><span class="line">&#125;); </span><br></pre></td></tr></table></figure>

<p>執行並在瀏覽器連上 localhost：3000<br><img src="https://i.imgur.com/pOQsXhE.png"></p>
<p>可以看到 <code>req</code> 物件包含了很多東西，例如標頭，標頭是有關請求類型的 meta data 元數據預期的響應類型…等等。<br><img src="https://i.imgur.com/zp9i0UJ.png"><br><br /></p>
<p>我們可以再改成如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params"> req, res</span>) =&gt;</span> &#123; <span class="comment">// 兩個參數 req 為請求物件，res 為響應回覆物件</span></span><br><span class="line">    <span class="built_in">console</span>.log(req.url);</span><br><span class="line">    <span class="built_in">console</span>.log(req.method);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>, <span class="string">&#x27;localhost&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;listening for requests on port 3000&#x27;</span>)</span><br><span class="line">&#125;); </span><br></pre></td></tr></table></figure>

<p>執行結果<br><img src="https://i.imgur.com/yPymCdl.png"></p>
<p><code>req.url</code> 為 <code>/</code> ，不是 <code>localhost:3000</code> 是因為它以此為根，所以才顯示 <code>/</code>，試著將網址後面添加 /about<br><img src="https://i.imgur.com/FpgxuJE.png"></p>
<p>可以看到結果如下<br><img src="https://i.imgur.com/utPRuNC.png"></p>
<p><code>req.method</code> 表示是一個使用 GET 方法的請求<br><br /></p>
<h2 id="Response-Object"><a href="#Response-Object" class="headerlink" title="Response Object"></a>Response Object</h2><p>在前一章的筆記中，連上了 <code>localhost:3000</code> 卻顯示找不到網頁的訊息是因為我們沒有做響應的處理，接下來就要透過 response 物件處理這部分。</p>
<p>現在我們想提出某種類型的內容回應，要制定相對應的 response header 響應頭給予瀏覽器對於將接收的響應更多信息。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params"> req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(req.url);</span><br><span class="line">    <span class="built_in">console</span>.log(req.method);</span><br><span class="line">    </span><br><span class="line">    res.setHeader(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/plain&#x27;</span>); <span class="comment">// set header content type</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>, <span class="string">&#x27;localhost&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;listening for requests on port 3000&#x27;</span>)</span><br><span class="line">&#125;); </span><br></pre></td></tr></table></figure>

<p><code>Content-Type</code> 表示內容類型，可以是 text, HTML, 或是 json，例如 <code>&#39;text/plain&#39;</code> 即發送純文本給瀏覽器。</p>
<p>設置完 response header，接著實際發送數據到瀏覽器，使用 <code>res.write()</code>，還要加上 <code>res.end()</code> 表示響應結束</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params"> req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(req.url);</span><br><span class="line">    <span class="built_in">console</span>.log(req.method);</span><br><span class="line">    </span><br><span class="line">    res.setHeader(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/plain&#x27;</span>); <span class="comment">// set header content type</span></span><br><span class="line">    res.write(<span class="string">&#x27;Hello, Joe!&#x27;</span>); <span class="comment">// write a response to the client</span></span><br><span class="line">    res.end(); <span class="comment">// end the response</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>, <span class="string">&#x27;localhost&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;listening for requests on port 3000&#x27;</span>)</span><br><span class="line">&#125;); </span><br></pre></td></tr></table></figure>
<br />

<p>接著執行並且連上 <code>localhost:3000</code>，出現以下內容<br><img src="https://i.imgur.com/Caulidt.png"></p>
<p>我們可以開啟「開發人員工具」的 Network 標籤 ( F12 或是 Ctrl + shift + I 開啟)<br><img src="https://i.imgur.com/6pwXf4O.png"></p>
<p>按 Ctrl + R 刷新<br><img src="https://i.imgur.com/K1C3w13.png"></p>
<p>點擊 localhost<br><img src="https://i.imgur.com/tAklTbu.png"></p>
<p>選擇 Headers 標籤可以看到 Response Headers 當中的內容類型為 text/plain，與我們在伺服器設定的一樣<br><img src="https://i.imgur.com/nCmeSnQ.png"><br><br /></p>
<p>若是我們想回應一些 HTML 內容，而不是純文本呢?</p>
<p>首先更改響應標頭，將內容類型改為 <code>&#39;text/html&#39;</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.setHeader(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/html&#x27;</span>);</span><br></pre></td></tr></table></figure>


<p>接著修改內容</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res.write(<span class="string">&#x27;&lt;p&gt;Hello, Joe!&lt;/p&gt;&#x27;</span>);</span><br><span class="line">res.write(<span class="string">&#x27;&lt;p&gt;Hello again, Joe!&lt;/p&gt;&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>目前的 code</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params"> req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(req.url);</span><br><span class="line">    <span class="built_in">console</span>.log(req.method);</span><br><span class="line">    </span><br><span class="line">    res.setHeader(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/html&#x27;</span>);</span><br><span class="line">    res.write(<span class="string">&#x27;&lt;p&gt;Hello, Joe!&lt;/p&gt;&#x27;</span>);</span><br><span class="line">    res.write(<span class="string">&#x27;&lt;p&gt;Hello again, Joe!&lt;/p&gt;&#x27;</span>);</span><br><span class="line">    res.end();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>, <span class="string">&#x27;localhost&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;listening for requests on port 3000&#x27;</span>)</span><br><span class="line">&#125;); </span><br></pre></td></tr></table></figure>


<p>執行<br><img src="https://i.imgur.com/2RV1pkN.png"></p>
<p>可以檢查這些內容發現為 p 元素<br>當然也可以將內容添加 head 等其它元素</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params"> req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(req.url);</span><br><span class="line">    <span class="built_in">console</span>.log(req.method);</span><br><span class="line">    </span><br><span class="line">    res.setHeader(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/html&#x27;</span>);</span><br><span class="line">    res.write(<span class="string">&#x27;&lt;head&gt;&lt;link rel=&quot;stylesheet&quot; href=&quot;#&quot;&gt;&lt;/head&gt;&#x27;</span>);</span><br><span class="line">    res.write(<span class="string">&#x27;&lt;p&gt;Hello, Joe!&lt;/p&gt;&#x27;</span>);</span><br><span class="line">    res.write(<span class="string">&#x27;&lt;p&gt;Hello again, Joe!&lt;/p&gt;&#x27;</span>);</span><br><span class="line">    res.end();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>, <span class="string">&#x27;localhost&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;listening for requests on port 3000&#x27;</span>)</span><br><span class="line">&#125;); </span><br></pre></td></tr></table></figure>

<p>雖然這樣可以回應 HTML 給瀏覽器，但如果我們像這樣添加更多的內容會非常的混亂，所以這不是一個好方法。</p>
<p>我們應該創建 HTML 在一個單獨的文件中，然後使用 Node.js 讀取這些文件並發送給瀏覽器，所以要再次使用上個章節介紹的 fs 檔案系統模組。<br><br /></p>
<h2 id="回傳-HTML-頁面"><a href="#回傳-HTML-頁面" class="headerlink" title="回傳 HTML 頁面"></a>回傳 HTML 頁面</h2><p>首先建立一個資料夾名為 views ，用於存放要回應的 HTML 檔案<br><img src="https://i.imgur.com/va2TnmG.png"></p>
<p>index.html 內容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1.0&quot;&gt;</span><br><span class="line">    &lt;title&gt;Node.js Test&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;Home&lt;&#x2F;h1&gt;</span><br><span class="line">    &lt;p&gt;This is a test!&lt;&#x2F;p&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>
<br />

<p>接著修改 server.js，新增</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br></pre></td></tr></table></figure>
<br />

<p>內容類型不變，使用 <code>fs.readFile()</code> 讀取檔案並在沒有 err 的情況下響應到瀏覽器</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">res.setHeader(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/html&#x27;</span>);</span><br><span class="line">fs.readFile(<span class="string">&#x27;./views/index.html&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123; <span class="comment">// send a HTML file</span></span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">        res.end(); <span class="comment">// 即使錯誤也要結束響應</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.write(data);</span><br><span class="line">        res.end();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<br />

<p>全部的 code</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params"> req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.setHeader(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/html&#x27;</span>);</span><br><span class="line">    fs.readFile(<span class="string">&#x27;./views/index.html&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;  <span class="comment">// send a HTML file</span></span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(err);</span><br><span class="line">            res.end(); <span class="comment">// 即使錯誤也要結束響應</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.write(data);</span><br><span class="line">            res.end();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>, <span class="string">&#x27;localhost&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;listening for requests on port 3000&#x27;</span>)</span><br><span class="line">&#125;); </span><br></pre></td></tr></table></figure>


<p>接著執行，重新整理 <code>localhost:3000</code> 頁面，結果顯示了 index.html<br><img src="https://i.imgur.com/5XT4JyE.png"></p>
<p>另外如果只寫入一樣東西到響應，可以寫在 <code>res.end()</code> 即可，它仍會執行相同的操作</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// res.write(data);</span></span><br><span class="line">res.end(data);</span><br></pre></td></tr></table></figure>

<p>若是要編寫多個內容，則寫多個 <code>res.write()</code> ，最後 <code>res.end()</code></p>
<p>以上就是一個將 HTML 頁面發送到瀏覽器的方式。<br><br /></p>
<h2 id="基礎路由"><a href="#基礎路由" class="headerlink" title="基礎路由"></a>基礎路由</h2><p>現在不論你在 <code>localhost:3000/</code> 後面加什麼內容</p>
<p>所引導的響應都一樣會是 index.html<br><img src="https://i.imgur.com/FwP2Csv.png"></p>
<p>但我們想根據訪問的路線來響應不一樣的頁面，所以我們需要一種方法找到發出請求的 URL，並根據此 URL 響應相對應的頁面。<br>(前面有使用 req.url 顯示)</p>
<p>首先在 views 資料夾新增 about.html 及 404.html<br><img src="https://i.imgur.com/N2zicdB.png"><br><br /></p>
<p>404.html 內容，用於使用者訪問不存在的路線時響應的頁面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1.0&quot;&gt;</span><br><span class="line">    &lt;title&gt;Node.js Test&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;404 哎呀!找不到該頁面!&lt;&#x2F;h1&gt;</span><br><span class="line">    &lt;p&gt;該頁面不存在喔!&lt;&#x2F;p&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>
<br />

<p>about.html 內容，用於路徑為 <code>/about</code> 時，響應該頁面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1.0&quot;&gt;</span><br><span class="line">    &lt;title&gt;Node.js Test&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;About&lt;&#x2F;h1&gt;</span><br><span class="line">    &lt;p&gt;This is an about page.&lt;&#x2F;p&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>
<br />

<p>接著修改 server.js ，<code>path</code> 為要響應的檔案路徑，使用 <code>switch</code> 來判斷使用者輸入了何種路徑</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> path = <span class="string">&quot;./views/&quot;</span>; <span class="comment">// 要從 views 取其中的檔案來響應</span></span><br><span class="line"><span class="keyword">switch</span>(req.url) &#123; <span class="comment">// 根據 req.url 判斷路徑</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">        path += <span class="string">&#x27;index.html&#x27;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;/about&#x27;</span>:</span><br><span class="line">        path += <span class="string">&#x27;about.html&#x27;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>: <span class="comment">// 前面的選項都不符合，最後就是找不到該頁面了</span></span><br><span class="line">        path += <span class="string">&#x27;404.html&#x27;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />

<p>讀取檔案路徑改為讀取 <code>path</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.readFile(path, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br></pre></td></tr></table></figure>
<br />

<p>全部的 code</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params"> req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> path = <span class="string">&quot;./views/&quot;</span>; <span class="comment">// 要從 views 取其中的檔案來響應</span></span><br><span class="line">    <span class="keyword">switch</span>(req.url) &#123; <span class="comment">// 根據 req.url 判斷路徑</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">            path += <span class="string">&#x27;index.html&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;/about&#x27;</span>:</span><br><span class="line">            path += <span class="string">&#x27;about.html&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>: <span class="comment">// 前面的選項都不符合，最後就是找不到該頁面了</span></span><br><span class="line">            path += <span class="string">&#x27;404.html&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    res.setHeader(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/html&#x27;</span>); <span class="comment">// set header content type</span></span><br><span class="line">    fs.readFile(path, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;  <span class="comment">// send a HTML file</span></span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(err);</span><br><span class="line">            res.end(); <span class="comment">// 即使錯誤也要結束響應</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// res.write(data);</span></span><br><span class="line">            res.end(data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>, <span class="string">&#x27;localhost&#x27;</span>, <span class="function">() =&gt;</span> &#123; </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;listening for requests on port 3000&#x27;</span>);</span><br><span class="line">&#125;); </span><br></pre></td></tr></table></figure>
<br />


<p>現在執行並輸入各種路徑觀察<br><strong>顯示首頁</strong><br><img src="https://i.imgur.com/G2BkOBH.png"><br><img src="https://i.imgur.com/wmVUVbC.png"><br><br /></p>
<p><strong>顯示 about 頁面</strong><br><img src="https://i.imgur.com/xhWZnQt.png"><br><img src="https://i.imgur.com/StpdG7e.png"><br><br /></p>
<p><strong>隨便輸入路徑，顯示 404 頁面</strong><br><img src="https://i.imgur.com/IkuN2zC.png"><br><img src="https://i.imgur.com/dZ53KnD.png"><br><br /></p>
<p>以上可以讓我們自由的根據 URL 響應多個不同的頁面。<br><br /></p>
<h2 id="Status-Codes-狀態代碼"><a href="#Status-Codes-狀態代碼" class="headerlink" title="Status Codes 狀態代碼"></a>Status Codes 狀態代碼</h2><p>在連到找不到網頁的情況下<br><img src="https://i.imgur.com/urz3Zhg.png"></p>
<p>開啟開發人員工具的 Network，注意到 123 的 status 為 200，此為現在要介紹的 status codes 狀態代碼<br><img src="https://i.imgur.com/UyUYiA1.png"><br><br /></p>
<p>響應的狀態代碼，描述了響應發送到瀏覽器的狀態，常見有以下：</p>
<ol>
<li>200 - OK 一切正常</li>
<li>301 - Resource moved 資源已永久移動到某處，表示請求資源的 URL 已被改變</li>
<li>404 - Not found 找不到該頁面</li>
<li>500 - Internal server error 內部的伺服器錯誤<br />

</li>
</ol>
<p>有更多的狀態代碼，通常分布於 100, 200, 300, 400, 500 的範圍</p>
<ol>
<li>資訊回應 (Informational responses, 100–199),</li>
<li>成功回應，按計畫進行 (Successful responses, 200–299),</li>
<li>重定向 (Redirects, 300–399),</li>
<li>用戶或客戶端的錯誤 (Client errors, 400–499),</li>
<li>伺服器端的錯誤 (Server errors, 500–599).<br />

</li>
</ol>
<p>現在添加這些狀態代碼到我們的響應中，在 <code>switch</code> 中對 <code>res.statusCode</code> 進行設置， <code>&#39;/&#39;</code> 或 <code>&#39;/about&#39;</code> 都是正常的狀態，除此之外則為 404 找不到網頁</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span>(req.url) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">        path += <span class="string">&#x27;index.html&#x27;</span>;</span><br><span class="line">        res.statusCode = <span class="number">200</span>; <span class="comment">// 一切正常</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;/about&#x27;</span>:</span><br><span class="line">        path += <span class="string">&#x27;about.html&#x27;</span>;</span><br><span class="line">        res.statusCode = <span class="number">200</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        path += <span class="string">&#x27;404.html&#x27;</span>;</span><br><span class="line">        res.statusCode = <span class="number">404</span>; <span class="comment">// 該資源不存在</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />

<p>全部的 code</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params"> req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> path = <span class="string">&quot;./views/&quot;</span>;</span><br><span class="line">    <span class="keyword">switch</span>(req.url) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">            path += <span class="string">&#x27;index.html&#x27;</span>;</span><br><span class="line">            res.statusCode = <span class="number">200</span>; <span class="comment">// 一切正常</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;/about&#x27;</span>:</span><br><span class="line">            path += <span class="string">&#x27;about.html&#x27;</span>;</span><br><span class="line">            res.statusCode = <span class="number">200</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            path += <span class="string">&#x27;404.html&#x27;</span>;</span><br><span class="line">            res.statusCode = <span class="number">404</span>; <span class="comment">// 該資源不存在</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    res.setHeader(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/html&#x27;</span>);</span><br><span class="line">    fs.readFile(path, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(err);</span><br><span class="line">            res.end();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// res.write(data);</span></span><br><span class="line">            res.end(data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>, <span class="string">&#x27;localhost&#x27;</span>, <span class="function">() =&gt;</span> &#123; </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;listening for requests on port 3000&#x27;</span>);</span><br><span class="line">&#125;); </span><br></pre></td></tr></table></figure>

<p>執行，依舊連到 <code>/123</code>，發現狀態為 404 了(favicon.ico 與我們無關，這裡不管)<br><img src="https://i.imgur.com/bymNKfM.png"></p>
<p>可以連上 <code>/about</code><br><img src="https://i.imgur.com/2be5P2a.png"></p>
<p>或是 <code>/</code> ，狀態都為 200<br><img src="https://i.imgur.com/JOCBzbs.png"><br><br /></p>
<h2 id="Redirects-重新定向"><a href="#Redirects-重新定向" class="headerlink" title="Redirects 重新定向"></a>Redirects 重新定向</h2><p>假設我們有一個網站，其中一個路徑為 <code>&#39;/about-me&#39;</code>，但後來決定將該路徑改為 <code>&#39;/about&#39;</code>，依照前面的做法將 <code>switch</code> 中的 URL 從 <code>&#39;/about-me&#39;</code> 改成 <code>&#39;/about&#39;</code> 即可，但萬一我的網站很受歡迎，有成千上萬的人點擊過去的連結，則會連到 404 的頁面(因為該頁面已不在)，所以我們應該偵測 <code>&#39;/about-me&#39;</code> 的 URL，並將其重新導向 <code>&#39;/about&#39;</code> 的頁面。</p>
<p>在 <code>switch</code> 新增 <code>&#39;/about-me&#39;</code> 的 case，雖然也可以用 <code>path</code> 指向 about.html 的方式，但這裡要做的是「重新定向」，首先設定 <code>statusCode</code> 為 301，表示進行了永久的重新定向，接著設定標頭，第一個參數是 <code>Location</code> 屬性，第二個參數則是重新定向到哪裡，這裡即 <code>&#39;/about&#39;</code>，最後要加上該次的響應結束。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span>(req.url) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">        path += <span class="string">&#x27;index.html&#x27;</span>;</span><br><span class="line">        res.statusCode = <span class="number">200</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;/about&#x27;</span>:</span><br><span class="line">        path += <span class="string">&#x27;about.html&#x27;</span>;</span><br><span class="line">        res.statusCode = <span class="number">200</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;/about-me&#x27;</span>:</span><br><span class="line">        <span class="comment">// path += &#x27;about.html&#x27;;  不使用該方法</span></span><br><span class="line">        res.statusCode = <span class="number">301</span>; <span class="comment">// 表示進行了永久的重新定向</span></span><br><span class="line">        res.setHeader(<span class="string">&#x27;Location&#x27;</span>, <span class="string">&#x27;/about&#x27;</span>); <span class="comment">// 重新定向到 /about 路徑</span></span><br><span class="line">        res.end();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        path += <span class="string">&#x27;404.html&#x27;</span>;</span><br><span class="line">        res.statusCode = <span class="number">404</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br />

<p>全部的 code</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params"> req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> path = <span class="string">&quot;./views/&quot;</span>;</span><br><span class="line">    <span class="keyword">switch</span>(req.url) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">            path += <span class="string">&#x27;index.html&#x27;</span>;</span><br><span class="line">            res.statusCode = <span class="number">200</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;/about&#x27;</span>:</span><br><span class="line">            path += <span class="string">&#x27;about.html&#x27;</span>;</span><br><span class="line">            res.statusCode = <span class="number">200</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;/about-me&#x27;</span>:</span><br><span class="line">            <span class="comment">// path += &#x27;about.html&#x27;;  不使用該方法</span></span><br><span class="line">            res.statusCode = <span class="number">301</span>; <span class="comment">// 表示進行了永久的重新定向</span></span><br><span class="line">            res.setHeader(<span class="string">&#x27;Location&#x27;</span>, <span class="string">&#x27;/about&#x27;</span>); <span class="comment">// 重新定向到 /about 路徑</span></span><br><span class="line">            res.end();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            path += <span class="string">&#x27;404.html&#x27;</span>;</span><br><span class="line">            res.statusCode = <span class="number">404</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    res.setHeader(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/html&#x27;</span>);</span><br><span class="line">    fs.readFile(path, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(err);</span><br><span class="line">            res.end();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// res.write(data);</span></span><br><span class="line">            res.end(data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>, <span class="string">&#x27;localhost&#x27;</span>, <span class="function">() =&gt;</span> &#123; </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;listening for requests on port 3000&#x27;</span>);</span><br><span class="line">&#125;); </span><br></pre></td></tr></table></figure>
<br />

<p>現在執行，輸入以下網址<br><img src="https://i.imgur.com/WOHEL7E.png"></p>
<p>頁面會自動引導到 <code>/about</code> 頁面<br><img src="https://i.imgur.com/Qc9o4wB.png"><br><img src="https://i.imgur.com/mZMGe1s.png"></p>
<p>開啟開發人員工具 Network 標籤，觀察到 about-me 狀態為 301<br><img src="https://i.imgur.com/ajp1Nju.png"></p>
<p>觀看其 Headers 可以看到 Location 的部分<br><img src="https://i.imgur.com/ONfzeEj.png"><br><br /></p>
<p>以上為伺服器響應網頁的基礎，但隨著網站越來越大，變得更複雜，要處理許多不同類型的請求，如發布、刪除請求以及有關數據庫的邏輯… 等等，這些以上面所學的方式處理會有些混亂、難維護，但幸運的是有名為 Express 的第三方框架，可以幫助我們更輕鬆的處理、管理以上問題。</p>
<p>即使如此我們也該先了解 Node.js 在這中間的過程，再學習 Express 會對於為什麼這麼做比較有感受及輕鬆。<br><br><br></p>
<hr>
<p><strong>參考資料</strong><br><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=DQD00NAUPNk">The Net Ninja | Node.js Crash Course Tutorial #4 - Requests &amp; Responses</a></p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Node-js/">Node.js</a></div><div class="post_share"><div class="social-share" data-image="https://i.imgur.com/4OIbWlf.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/12/30/Node-js-NPM-%E5%A5%97%E4%BB%B6%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7/"><img class="prev-cover" src="https://i.imgur.com/4OIbWlf.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">[Node.js] NPM 套件管理工具</div></div></a></div><div class="next-post pull-right"><a href="/2020/12/28/Node-js-%E5%AE%A2%E6%88%B6%E7%AB%AF%E8%88%87%E4%BC%BA%E6%9C%8D%E5%99%A8%E7%AB%AF/"><img class="next-cover" src="https://i.imgur.com/4OIbWlf.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">[Node.js] 客戶端與伺服器端</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相關推薦</span></div><div class="relatedPosts-list"><div><a href="/2020/12/26/Node-js-介紹與開始/" title="[Node.js] 介紹與開始"><img class="cover" src="https://i.imgur.com/4OIbWlf.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-12-26</div><div class="title">[Node.js] 介紹與開始</div></div></a></div><div><a href="/2020/12/26/Node-js-基礎與檔案系統/" title="[Node.js] 基礎與檔案系統"><img class="cover" src="https://i.imgur.com/4OIbWlf.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-12-26</div><div class="title">[Node.js] 基礎與檔案系統</div></div></a></div><div><a href="/2020/12/28/Node-js-客戶端與伺服器端/" title="[Node.js] 客戶端與伺服器端"><img class="cover" src="https://i.imgur.com/4OIbWlf.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-12-28</div><div class="title">[Node.js] 客戶端與伺服器端</div></div></a></div><div><a href="/2020/12/30/Node-js-NPM-套件管理工具/" title="[Node.js] NPM 套件管理工具"><img class="cover" src="https://i.imgur.com/4OIbWlf.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-12-30</div><div class="title">[Node.js] NPM 套件管理工具</div></div></a></div><div><a href="/2021/01/17/Node-js-Express/" title="[Node.js] Express"><img class="cover" src="https://i.imgur.com/4OIbWlf.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-01-17</div><div class="title">[Node.js] Express</div></div></a></div><div><a href="/2021/01/17/Node-js-View-Engines/" title="[Node.js] View Engines"><img class="cover" src="https://i.imgur.com/4OIbWlf.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-01-17</div><div class="title">[Node.js] View Engines</div></div></a></div></div></div></div><div class="aside_content" id="aside_content"><div class="card-widget card-info"><div class="card-content"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">JoeB</div><div class="author-info__description">學習各種東西的記錄或是分享有趣的事物</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">17</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">標籤</div><div class="length-num">6</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分類</div><div class="length-num">1</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div></div><div class="card-widget card-announcement"><div class="card-content"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="card-content"><div class="item-headline"><i class="fas fa-stream"></i><span>目錄</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Node-js-%E8%AB%8B%E6%B1%82%E8%88%87%E9%9F%BF%E6%87%89"><span class="toc-text">[Node.js] 請求與響應</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Request-Object"><span class="toc-text">Request Object</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Response-Object"><span class="toc-text">Response Object</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9E%E5%82%B3-HTML-%E9%A0%81%E9%9D%A2"><span class="toc-text">回傳 HTML 頁面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A4%8E%E8%B7%AF%E7%94%B1"><span class="toc-text">基礎路由</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Status-Codes-%E7%8B%80%E6%85%8B%E4%BB%A3%E7%A2%BC"><span class="toc-text">Status Codes 狀態代碼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redirects-%E9%87%8D%E6%96%B0%E5%AE%9A%E5%90%91"><span class="toc-text">Redirects 重新定向</span></a></li></ol></li></ol></div></div></div><div class="card-widget card-recent-post"><div class="card-content"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/02/07/JS-Scope-Scope-chain/" title="[JS] Hoisting 提升"><img src="https://i.imgur.com/fyD4pxY.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="[JS] Hoisting 提升"/></a><div class="content"><a class="title" href="/2021/02/07/JS-Scope-Scope-chain/" title="[JS] Hoisting 提升">[JS] Hoisting 提升</a><time datetime="2021-02-07T06:32:19.000Z" title="發表於 2021-02-07 14:32:19">2021-02-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/02/07/Node-js-MongoDB/" title="[Node.js] MongoDB"><img src="https://i.imgur.com/4OIbWlf.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="[Node.js] MongoDB"/></a><div class="content"><a class="title" href="/2021/02/07/Node-js-MongoDB/" title="[Node.js] MongoDB">[Node.js] MongoDB</a><time datetime="2021-02-07T06:15:37.000Z" title="發表於 2021-02-07 14:15:37">2021-02-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/02/06/Node-js-Middleware-%E4%B8%AD%E4%BB%8B%E8%BB%9F%E9%AB%94/" title="[Node.js] Middleware 中介軟體"><img src="https://i.imgur.com/4OIbWlf.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="[Node.js] Middleware 中介軟體"/></a><div class="content"><a class="title" href="/2021/02/06/Node-js-Middleware-%E4%B8%AD%E4%BB%8B%E8%BB%9F%E9%AB%94/" title="[Node.js] Middleware 中介軟體">[Node.js] Middleware 中介軟體</a><time datetime="2021-02-06T05:08:30.000Z" title="發表於 2021-02-06 13:08:30">2021-02-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/01/25/JS-DOM-%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%82%B3%E9%81%9E%E6%A9%9F%E5%88%B6-%E6%8D%95%E7%8D%B2-%E5%86%92%E6%B3%A1/" title="[JS] DOM 的事件傳遞機制? 捕獲? 冒泡?"><img src="https://i.imgur.com/fyD4pxY.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="[JS] DOM 的事件傳遞機制? 捕獲? 冒泡?"/></a><div class="content"><a class="title" href="/2021/01/25/JS-DOM-%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%82%B3%E9%81%9E%E6%A9%9F%E5%88%B6-%E6%8D%95%E7%8D%B2-%E5%86%92%E6%B3%A1/" title="[JS] DOM 的事件傳遞機制? 捕獲? 冒泡?">[JS] DOM 的事件傳遞機制? 捕獲? 冒泡?</a><time datetime="2021-01-25T07:17:12.000Z" title="發表於 2021-01-25 15:17:12">2021-01-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/01/18/JS-Closure-%E9%96%89%E5%8C%85/" title="[JS] Closure 閉包"><img src="https://i.imgur.com/fyD4pxY.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="[JS] Closure 閉包"/></a><div class="content"><a class="title" href="/2021/01/18/JS-Closure-%E9%96%89%E5%8C%85/" title="[JS] Closure 閉包">[JS] Closure 閉包</a><time datetime="2021-01-18T07:40:38.000Z" title="發表於 2021-01-18 15:40:38">2021-01-18</time></div></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://i.imgur.com/4OIbWlf.png)"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By JoeB</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主題 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="閱讀模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="淺色和深色模式轉換"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="設定"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="目錄"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到頂部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script></div></body></html>